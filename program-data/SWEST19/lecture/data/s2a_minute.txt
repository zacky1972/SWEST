**********************************************************************
セッションs2a
テーマ：LPWA通信とSORACOMプラットフォームを活用したIoT最新技術と活用事例
講師：松下享平（株式会社ソラコム）
日時：2017/8/25 9:00-10:10
参加人数：23名（終了時）
**********************************************************************

・自己紹介
　　- 前職：東証二部ハードウェアメーカーでIOT事業のコーディネート.
　　- 株式会社ソラコム所属.
　　- テクノロジー・エバンジェリスト.

・アジェンダ
　　○なぜ今IoTなのか
　　　- これから何が起こるのか
　　○LoRaWAN概説
　　○SORACOM Air for LoRaWAN
　　　- SORACOMとは？
　　　- SORACOM Air for LoRaWANで何が提供されるのか？
　　　- 実際の開発で必要なものは？
　　　- 狭域データペイロードを最大限に活用する方法

・なぜ今IoTなのか？
　　○事例：自動改札
　　○すごいモノ（自動改札の機械）, すごいネットワーク, すごいデータセンターの3つを揃えれば
　　　自動改札の事業を始めることができる.
　　　- 従来は簡単に用意できなかったものだが, 現在は簡単に即座に利用できる環境が整ってきている.

　　○すごいデータセンターの代わりとして, クラウドを利用することができる.
　　　- 例：AWS, Microsoft Azure, Google Cloud Platform, IBM Bluemix など. これらの
　　　  　　各社がマーケットの58%を占めている.
　　　- クラウドの特徴　+ 必要な時にすぐ調達できる.
　　　  　　　　　　　　+ 使用する分だけ用意できる. 過不足に応じて自由にスケーリングできる.
　　　  　　　　　　　　+ 個人から大企業まで誰でも同じ技術を利用できる.
　　○クラウド利用のメリット
　　　- 個人でサーバーを調達するとサーバー費用は増える一方になる.
　　　  サービスの需要に合わせて自由にスケーリングできない.
　　　  また調達が間に合わず急な増加に対応できない.
　　　- クラウドなら, 不要になった時点で減らすことが可能.
　　　  また必要になった時点で即座に調達できる.
　　　- モノとクラウドを繋ぐとき, ラズベリーパイなど一台からの検証目的でも,
　　　  事業本番における数万台規模の環境でもクラウドなら簡単にスケーリングできる.
　　　  クラウドとIoTの組み合わせはビジネス的な相性がとても良い！
　　　- クラウドなら, 誰でも等しく同じ機能が利用できる. 構築済みのサービスを利用できる.
　　○クラウドを利用すればすごいデータセンターの用意は不要！

　　○すごいモノ
　　　- 誰でも使えるモノ作りの道具が揃ってきている.
　　　- Arduino, ラズベリーパイなどが存在しプロトタイピングが容易.
　　　  物によってはそのまま事業本番でも利用できるため, すごいモノを一から作る必要はない.
　　　- 3Dプリンタによるデジタルファブリケーション.
　　　  航空機のエンジンなどが作れるほどに3Dプリンタの性能も向上してきており,
　　　  作りたいモノの外装やケースを容易に作成できる.

　　○すごいネットワーク
　　　- 課題：接続方法, セキュリティ, 通信の管理.
　　○接続方法の課題
　　　- 有線LAN：場所, 配線の制約.
　　　- 無線LAN：事前設定, 人が介在する前提.　＝＞　いずれも使いにくい.
　　　- 3G・LTE通信：購入してくればすぐ利用できる. 人間が利用することを想定したプラン.
　　　    　   　　　割高の通信費, 長期固定契約.
　　　    　   　　　　＝＞　事業で利用することが想定されていない契約形態.
　　○セキュリティの課題
　　　- 暗号化, 認証のために高性能CPUを利用するとデバイス単価の高騰.
　　○通信の管理の課題
　　　- 事業を進化させていくにつれて通信先の変更などが必要となってくる.
　　○ソリューション：SORACOM Air for セルラー
　　　- 誰でも安価かつ簡単に利用できるモノ向けの通信サービス.

　　○なぜ今IoTなのか？
　　　- 誰でも利用できるモノづくりの道具, 誰でも利用できる無線通信ネットワーク,
　　　  誰でも利用できるクラウドが揃っている.
　　　- アイディアがあれば誰でも事業に参入できる.

　　○これから何が起こるのか
　　　- 全く異なる業種, 特にクラウド界隈からモノづくりへの参入.
　　　- 例：アマゾンダッシュボタン, グーグルホーム, SKB（トヨタ）, スマート内覧,
　　　  　　スマートルームセキュリティなど.
　　　- ハードウェアはサービスの部品の一つとなり,
　　　  見かけ上のハードウェアの価値は限りなくゼロになってきている.
　　　- しかし本質は, ハードウェアは顧客の囲い込みに最適でありハードウェアの重要性は
　　　  増している. ビジネス全体の中でのハードウェアの位置づけを考えることが重要.
　　　  ビジネスで何が必要なのかということをハードウェアに組みこむことが重要.

・LoRaWAN概説
　　○LPWA
　　　- Low Power Wide Area ネットワーク.
　　　- 非常に低消費電力で動作する長距離ネットワーク.
　　　- LPWAは基本的に通信距離1km以上.
　　○LoRaWAN
　　　- LPWAと呼ばれる無線通信規格の1つ.
　　　- センサー/デバイスといったモノとクラウドの間を繋ぐ技術.
　　　- 低消費電力：セルラー通信がデータ送信時に500～600ミリアンペア消費するのに対して,
　　　  　　　　　　LoRaWANでは, 20分の1以下の20～30ミリアンペアしか消費しない.
　　　  　　　　　　これは赤色LEDを一度点灯するのと同等の消費電力である.
　　　- 長距離ネットワーク:条件が良ければ通信距離は10kmにも及ぶ.
　　　- 詳しい技術仕様はLoRa Allianceで公開されている.
　　○LoRaとLoRaWANの違い
　　　- LoRaは変調方式. データから電波, 電波からデータへの変換方式を表現したもの.
　　　- LoRaWANはLoRaを利用してデータアクセスをする仕組み.
　　　  LoRaを利用することを前提として, MACレイヤー（レイヤー2）まで含めた通信の仕様.
　　　  またEthernetなどにおけるHTTP等の仕組みは存在せず,
　　　  LoRaWANより上のレイヤーはユーザが実装する必要がある.
　　○LoRaWANのスペック
　　　- レイヤー1（物理層）　LoRa変調
　　　  　+ 国ごとに異なるISMバンド, 周波数帯を用いる. アジアは923Mhzの周辺.
　　　  　+ スペクトル拡散通信の一種. 拡散率（SF）を変更することで
　　　  　  データレート（DR）と伝播距離をトレードオフに変更できる.
　　　  　+ SFが大きいほど伝播距離は長くなるがDRは遅くなる.
　　　  　+ 日本国内で主に利用されるDRは2～5, DR2の場合伝播距離が最も長くなるが,
　　　  　  通信は980bps, 1送信にユーザが利用できるペイロードは11Byteと非常に小さくなる.
　　　- レイヤー2
　　　  　+ ネットワークアーキテクチャ. LoRaWANの仕様に含まれるのは,
　　　  　  LoRaWANデバイス⇔LoRaWANゲートウェイ⇔LoRaWANネットワークサーバの部分のみ.
　　　  　  ネットワークサーバ以降のアプリケーションサーバについてはユーザ任せ.
　　　  　+ デバイスとネットワークサーバ間の通信は共通鍵で暗号化される.
　　　  　+ デバイスとアプリケーションサーバ間でも暗号化を行うことができ,
　　　  　  2重に暗号化が可能である.
　　　  　+ LoRaWANの通信クラスは3種類存在するが,
　　　  　  仕様が決まっていて実装が存在するのはクラスAのみ.
　　　  　+ クラスA：全デバイスサポートの基本的なクラス.
　　　  　  デバイスはネットワークへのデータ送信の後,
　　　  　  一定時間だけネットワークからの下りデータを受信する.
　　　  　  ネットワーク側はデバイスからの上りデータ受信後に下りデータを送信する.
　　　  　  デバイスの受信装置がデータ送信後の短い時間しか動作しないため低消費電力である.
　　　  　  レイテンシは大きい.
　　　  　+ クラスA, B, Cの順に受信スロットの開放時間が長くなるため消費電力も増加する.
　　　  　  レイテンシは減少する.

・SORACOM Air for LoRaWAN
　　○株式会社ソラコム
　　　- 社員数約45名.
　　　- 前述した様々なネットワークの課題に対してセルラーの通信（SORACOM）を提供.
　　　- SIMを販売.
　　　- SORACOMの顧客は7000以上.
　　○SORACOMが実現したこと
　　　- 通常, 通信事業を始めるには基地局とデータセンター（パケット交換, 帯域制御,
　　　  顧客管理, 課金処理等を行うサーバ群）が必要となる.
　　　- SORACOMは基地局, データセンターといった物理的な通信設備を持っていない.
　　　  基地局はドコモの回線を利用し,
　　　  データセンター部分はAWSクラウドで仮想的な通信設備を実現.
　　　- セルラー基地局＋AWSクラウドの仮想的な通信設備.
　　　- AWSクラウド部分はあらかじめ複数の通信をサポートすることを想定しているため,
　　　  基地局の部分を置き換えることで即座に新しい通信サービスを始めることができる.
　　　- 基地局の部分をLoRaWAN, Sigfoxに置き換えることでそれぞれの通信サービスを提供できる.
　　　- AWS上でサービスを行っているため, 顧客のフィードバックを元に自分たちで迅速な開発,
　　　  サービスのアップグレード, 新サービスの提供を行うことができる.
　　○SORACOM Air for LoRaWAN
　　　- 2017年2月に商用サービス開始
　　　- 全国で実証実験を実施
　　　- 例　+ 牛にLoRaWANデバイスを装着し, 孤立している牛を発見.
　　　  　　+ 橋の振動をモニタリング, メンテナンスの必要な橋を発見する.
　　　  　　+ LoRaWANの長い通信距離を活用.
　　○LoRaWANを始めるために必要なもの
　　　- デバイス, ゲートウェイ, ネットワークサーバ, アプリケーションサーバ,
　　　  全てを自分で用意する必要がある.
　　　- SORACOMがLoRaWANのネットワークサーバをフルで提供.
　　　- ゲートウェイは購入して設置するだけで簡単に利用できる.
　　　  　+ SORACOM提供のLoRaWAN共有ゲートウェイを利用すれば,
　　　  　  設置済みのゲートウェイを即座に利用できる. また費用も安価である.
　　　- 顧客はLoRaWANデバイスの開発に注力できる.
　　　- 様々なLoRaWANの開発デバイスも提供されている.
　　○SORACOMのLoRaWANソリューション
　　　- SORACOM提供のLoRaWANネットワークサーバ.
　　　- SORACOM提供のLoRaWAN共有ゲートウェイ.
　　　- 様々なLoRaWANデバイス.
　　　- 顧客はこれらを必要に応じて選択し, 利用できる.
　　　- セルラー圏外エリアにおいては衛星通信を利用したLoRaWANの展開.

・狭域データペイロードを最大限に活用する方法
　　○LPWAとセルラーの使い分け
　　　- LPWA
　　　      　+ 通信の頻度, 一回当たりのデータサイズが少ない.
　　　      　+ 省電力運用.
　　　      　+ 通信カバレッジ, 都市部における無線通信, 山間部等のラストワンマイル.
　　　- セルラー
　　　      　+ 通信のデータサイズが大きい.
　　　      　+ 下り通信の即応性が必要.

　　○LoRaWANのペイロード設計
　　　- データサイズが11Byte（DR2）.
　　　- JSONを用いる場合, クラウド側で扱いやすいがデバイスでの生成コストは高い.
　　　- メッセージパックを用いる場合, クラウド・デバイス双方でそこそこ扱いやすいが,
　　　  徹底したデータサイズの削減は行われていない.
　　　- 独自フォーマットを用いる場合, デバイスでの生成コストは低いが,
　　　  クラウドでの扱いは困難となる.
　　　- SORACOMはバイナリパーサー機能が存在するのでカスタムデータフォーマットを利用できる.

・まとめ
　　○なぜ今IoTなのか
　　　- すごいモノ, すごいネットワーク, すごいデータセンターに代わる誰でも簡単に利用できる
　　　  環境が揃っている.
　　○LoRaWAN
　　　- モノとネットワークを繋ぐ通信に利用することができる.
　　○SORACOM Air
　　　- セルラーのみではなく, LoRaWAN, Sigfoxといった無線通信を提供.
　　　  今後も顧客の要望に応じて新しい無線通信サービスを提供していくことができる.
　　○SORACOM LoRaWANソリューション
　　　- LoRaWANネットワークサーバ, LoRaWAN共有ゲートウェイ,
　　　  LoRaWANデバイスを必要に応じて提供.

・質疑応答
　　○質問1
　　　Q：無線通信において通信の混雑が問題となるが,
　　　 　LoRaWANではどれくらいの人数が同時に接続可能であるのか？
　　　A：ゲートウェイの同時対応数は8チャンネル, 16チャンネル程度であることが多い.
　　　 　しかし, 一つの通信は連続400ミリ秒までという規定が存在しており,
　　　 　400ミリ秒ごとに違う通信が開始されるため実際には1台のゲートウェイで
　　　 　数千以上の接続に対応できる.
　　○質問2
　　　Q：通信が同時に来た場合の優先度付けはどのようになるのか？
　　　A：通信はどのチャンネルを利用するかをまず初めに宣言する.
　　　 　チャンネルが空いているかを確認し, 空いているところを使うので,
　　　 　チャンネルが空いていれば通信がかぶることはない.
　　　 　全てのチャンネルが埋まっている状態で同時に通信が来た場合の規定は実は存在しない.
　　　 　通信はゲートウェイ内でIPに変換されているので,
　　　 　通信の優先度はIPに依存すると考えられるが, IPの優先順位は規定されていないので,
　　　 　通信の優先度はIPの品質に依存するといえる.
　　○質問3
　　　Q：LoRaWANを利用するときに共有ゲートウェイを利用したいと考えているが,
　　　 　近所に共有ゲートウェイが存在しているか確認する方法は何があるのか？
　　　A：SORACOM共有ゲートウェイであれば,
　　　 　SORACOM LoRa Spaceというサービスで確認が可能である.
