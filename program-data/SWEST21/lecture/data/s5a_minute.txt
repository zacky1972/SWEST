**********************************************************************
セッションS5a 講演・チュートリアル
テーマ：高精度衛星測位 RTK−GNSS チュートリアル
講師：木谷　友哉 氏（静岡大学）
日時：2019/9/6(金) 14:10〜15:20
参加人数：30名（終了時）
**********************************************************************
機材の準備ができればcm単位での測定が家でもできます

■配布資料
  技術的な説明文書（7MB）
  http://kitanilab.org/swest21-pdfs/
  ソフトウェア（50MB）
  http://kitanilab.org/swest21-sw/
  ※配布スライドにはトラブルシューティングも載せてあるので参考に。

■イントロ（衛星測位の解説）
  ・現在は約40衛星から取得可能。

  ・原理：電波から各衛星からの距離を測定し三角測量。x,y,z座標に時間のずれも
    考慮した４変数を考える。

  ・距離の測り方
    - コード測位：測定コード信号が衛星によって違うので、そのずれから距離が
      測定できる

  ・搬送配送測距の原理
    搬送波（1.575GHz）の波数から求める
    1波長は約19cm、それを100分割した2mmの分解能で測定できる。
    ただし、整数部分は不確定。この整数値のために基準局が必要。複数の衛星からの
    波数で辻褄合わせも行う。

■今回お渡ししたセット(u-blox ZED-F9P, u-blox ANN MBO)
  1.5kHz,1.2GHzの2周波を計測できる
  （3，4年前は一台400万円もした！ただ現在は一台4万円程）。
  ※機器1つしかもっていなければ、rtk2go.comを使っている人で近隣の人を見つけたり、
    善意の基準局掲示板を参照する。（できれば10km以内が望ましい。動かないものの
    測定であれば30km程離れていてもいい）

■前準備
  まず何らかの手法で移動局側からデータを引っ張れるようにする（基準局は水明館の
  鯉池に設置してきました）。
  今回はWio-LTEを使って，フリーのNTRIPサーバに中継。

  国土地理院のサービスを利用すれば厳密な絶対位置が分かる。

  u-center：インストールを配布資料の通りに実行。
  RTKLIB：配布資料(zip)の実行ファイルを実行すればよい。

■実施項目リスト
  1. u-bloxモジュールをPCにシリアル通信デバイス（COMポート）として認識させる
  2. u-centerを知る
  3. u-bloxモジュールのファームウェアバージョン確認
  4. u-bloxモジュールのファームウェア更新

  ・データ形式
    - NMEAメッセージ
      GNSSモジュールが測位演算した結果を文字列として受け渡す標準フォーマット形式
    - UBXプロトコル
      u-blox社のGNSSモジュールで使われる観測データと設定データを表すデータ形式

■GNSSモジュールの設定手順（「４．Message」が最も重要）
  １．GNSS config
    国土地理院の電子基準点がBeiDouに対応していない。独自基準局をつかうときは
    BeiDouを使ってもよい．

  ２．RATE
    そんなに早く動かない場合（徒歩など）は1Hzでいい。
    当時はドローンを使用していたため5Hzに設定。

  ３．PRT（Ports）
    USB，I2C，UART1，UART2，SPI の5つのポート

  ４．Message
    02-15 RXM-RAWX : 搬送波位相観測データ
    02-13 RXM-SFRBX : 各衛星の航法データ
    の2つの設定からUSBにチェックを入れsendする必要がある。


■RTK測位ことはじめ
  基準局を固定し，その場所の位置を求める
    ・リアルタイム測位
      １．基準局は観測するデータをネットワーク経由で配信
      ２．移動局は，基準局の補正情報を得ながら，自身の観測データを元に
          RTK測位演算アプリ（RTKLIBのRTKNAVI）で演算
    ・後処理測位
      １．基準局と移動局の観測データをロギング
      ２．後処理演算ライブラリ（RTKLIBのRTKPOST）で測位演算をする

  ・RTKLIB
    フリーでオープンソースのGNSS測位計算用ソフトウェア
    RTKLIB_*/bin/rtklaunch.exe を実行すると，全ての利用可能なプログラムへの
    ランチャーが立ち上がる

  ・２つのアプリケーションプログラム
    １．RTKNAVI：リアルタイム測位演算アプリケーション
      optionのPositioning Modeでいろいろな設定ができます
    ２．SVRSTR：ストリームサーバ
      自前で作った基準局のデータを配信することができる

■注意点
  ・日本列島は毎年数cm動いていることにも注意する必要がある。
  ・マップのずれ（googleマップは10cmくらいのずれ）

■データロギング
  ラズパイの説明資料については研究室のＨＰを見てください。

■質疑応答
  Q.消費電力は従来のモノと比べてどうでしょうか？
  A.補足するチャンネル数が増えるので大きくなるが、元々大きいです。５ｖで
    ６００ｍＡくらいにまでなります。

  Q.バイクや車に乗せる場合は基準局と離れるので基準の変更は？
  A.リアルタイムでも後処理にも必要。ランダムに走るならばいろいろなところに
    基準局がないといけない。DocomoとSoftBankが全国に何千台置くと告知。
    国土地理院のデータは30秒に一回しかない（５秒に一回はほしい）

  Q.林道を走る場合はどうなのでしょうか？
  A.基準局は10km以内に欲しい。誤差の情報が収束に影響を与える。直接波がないと
    きつい。木の葉っぱでも遮られてしまうくらいに微弱な電波。またデータがぶつぶつ
    切れると時系列情報が使えず辻褄があわない。

  Q.天候の影響は？
  A.ほぼない。水蒸気の影響は大きいが基準局もそれは同じなので変わりない。

■まとめ
高精度衛星測位 RTKーGNSS を１０台用いてチュートリアルを行った。

以上。
